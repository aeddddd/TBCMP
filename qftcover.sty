%% ***********************************************************************
%%            Copyright 2024 by M.Y. XIA <xiamyphys@gmail.com>           *
%%                                                                       *
%%    This work may be distributed and/or modified under the conditions  *
%%    of the LaTeX Project Public License                                *
%%                                                                       *
%%               http://www.latex-project.org/lppl.txt                   *
%%                                                                       *
%%    either version 1.3c of this license or any later version.          *
%%                                                                       *
%%    This work has the LPPL maintenance status `maintained'.            *
%%                                                                       *
%%    The Current Maintainers of this work is M.Y. XIA                   *
%%                                                                       *
%%    This work consists of the files qftcover.sty                       *
%% ***********************************************************************
\def\qftcover@date{2024/12/17}
\def\qftcover@version{0.1B}

\RequirePackage{xparse}% For TeX Live 2019 - 2020 Compatibility
\ProvidesExplPackage {qftcover} {\qftcover@date} {\qftcover@version}
  {Cover Design For Physics Notebook}

% Module for texlive 2019 and later
\cs_if_exist:NF \exp_args:NNee 
  {
    \cs_new:Npn \exp_args:NNee #1#2#3#4
      {
        \tex_expanded:D
          {
            \exp_not:N #1 \exp_not:N #2
              { \__kernel_exp_not:w \tex_expanded:D {{#3}} }
              { \__kernel_exp_not:w \tex_expanded:D {{#4}} }
          }
      }
  }
\cs_if_exist:NF \seq_set_split:Nee 
  {
    \cs_new:Npn \seq_set_split:Nee #1#2#3
      {
        \exp_args:NNee \seq_set_split:Nnn #1 {#2} {#3}
      }
  }

\keys_define:nn { qft / coverset }
  {
    title .tl_set:N    = \l__qftcover_cover_title_tl,
    subtitle .tl_set:N = \l__qftcover_cover_subtitle_tl,
    bioinfo .tl_set:N  = \l__qftcover_cover_bioinfo_tl,
    color .tl_set:N    = \l__qftcover_cover_color_tl,
      color .initial:n = gray,
    head .tl_set:N     = \l__qftcover_cover_head_tl,
    logo .tl_set:N     = \l__qftcover_cover_logo_tl,
  }

\NewDocumentCommand \coverset { m }
  {
    \keys_set:nn { qft / coverset } {#1}
    % \exp_args:NNee
    \seq_set_split:Nee \l__qftcover_cover_head_seq {/}
      { \l__qftcover_cover_head_tl }
    % \exp_args:NNee
    \seq_set_split:Nee \l__qftcover_cover_logo_seq {/}
      { \l__qftcover_cover_logo_tl }
  }

\RequirePackage{ graphicx, geometry, circuitikz, pagecolor }
\geometry{ margin = 1in }
\graphicspath
  {
    {./figure/} {./figures/} {./image/} {./images/}
    {./graphics/} {./graphic/} {./pictures/} {./picture/}
  }
\ExplSyntaxOff
\usetikzlibrary{ fadings, patterns }
\ExplSyntaxOn

\RenewDocumentCommand \maketitle { }
  {
    \group_begin:
    \qftcover_maketitle:
    \group_end:
  }

\cs_new_protected_nopar:Npn \qftcover_maketitle:
  {
    \newpagecolor{\l__qftcover_cover_color_tl!10}
    \begin{titlepage}
      \begin{tikzpicture}[ remember~picture, overlay ]
        \fill [ white, opacity = .5 ] (current~page.south~east) rectangle +
          (-.8\paperwidth, .6\paperheight);
        \fill [ white, opacity = .5 ] (current~page.south~east) rectangle +
          (-.7\paperwidth, .7\paperheight);
        \node
          [ shift = {(-.35*\paperwidth,.65*\paperheight)},
            darkgray, font = \huge\bfseries\sffamily
          ] at (current~page.south~east) { \l__qftcover_cover_title_tl };
        \node
          [ shift = {(-.75*\paperwidth,.3*\paperheight)},
            rotate = 90, gray, opacity = .6, font = \LARGE\bfseries\sffamily
          ] at (current~page.south~east) { \l__qftcover_cover_subtitle_tl };
        \node
          [ shift = {(.15*\paperwidth,.075*\paperheight)},
            gray, opacity = .8, font = \large\sffamily
          ] at (current~page.south) { \l__qftcover_cover_bioinfo_tl };
        \tl_if_empty:NF { \l__qftcover_cover_head_tl }
          {
            \node
              [ rotate~around =
                  {
                    \seq_item:Nn \l__qftcover_cover_head_seq {2} \c_colon_str
                    (current~page.north)
                  },
                opacity = .4
              ] at ([yshift = .35\paperheight]current~page.center)
              {
                \includegraphics[ width = \paperwidth ]
                  { \seq_item:Nn \l__qftcover_cover_head_seq {1} }
              };
          }
        \tl_if_empty:NF { \l__qftcover_cover_logo_tl }
          {
            \node (cover~logo)
              [ shift = {(.65*\paperwidth,.3*\paperheight)} ]
              at (current~page.south~west)
              {
                \includegraphics[ height=.3\paperheight ]
                  { \seq_item:Nn \l__qftcover_cover_logo_seq {1} }
              };
            \fill
              [ pattern = \seq_item:Nn \l__qftcover_cover_logo_seq {2},
                pattern~color = \l__qftcover_cover_color_tl!15!white!25,
                scope~fading = south
              ] (cover~logo.south~west) rectangle (cover~logo.north~east);
          }
      \end{tikzpicture}
    \end{titlepage}
    \thispagestyle{empty}
    \cleardoublepage
    \restorepagecolor
  }

\endinput
% End of file `qftcover.sty'