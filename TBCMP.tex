%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% kaobook
% LaTeX Template
% Version 1.3 (December 9, 2021)
%
% This template originates from:
% https://www.LaTeXTemplates.com
%
% For the latest template development version and to make contributions:
% https://github.com/fmarotta/kaobook
%
% Authors:
% Federico Marotta (federicomarotta@mail.com)
% Based on the doctoral thesis of Ken Arroyo Ohori (https://3d.bk.tudelft.nl/ken/en)
% and on the Tufte-LaTeX class.
% Modified for LaTeX Templates by Vel (vel@latextemplates.com)
%
% License:
% CC0 1.0 Universal (see included MANIFEST.md file)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%---------------
%	宏包及文档配置
%--------
\PassOptionsToPackage{svgnames}{xcolor}
\documentclass[a4paper,fontsize=10pt,open=any,twoside=false,numbers=noenddot,UTF-8,]{kaobook}

%%% color
\colorlet{ColorTitle}{Black}
\colorlet{ColorSectionName}{Black}
\colorlet{ColorBoxFG}{Gray}
\colorlet{ColorBoxText}{Black}
\colorlet{ColorBoxBG}{White}
\definecolor{color1}{rgb}{0.5,0.6,0.7}
% Choose the language
\ifxetexorluatex
\usepackage{polyglossia}
\setmainlanguage{english}
\else
\usepackage[english]{babel} % Load characters and hyphenation
\fi
\usepackage[english=british]{csquotes}	% English quotes
\usepackage{ctex}
% Load packages for testing
\usepackage{tikz-feynman}
\usepackage{fixdif}
\usepackage{ulem}
\usetikzlibrary{tikzmark}
\usetikzlibrary{backgrounds}
\usetikzlibrary{arrows,shapes}
\usetikzlibrary{calc}
% Commands for Highlighting text -- non tikz method
\newcommand{\highlight}[2]{\colorbox{#1!17}{$\displaystyle #2$}}
%\newcommand{\highlight}[2]{\colorbox{#1!17}{$#2$}}
\newcommand{\highlightdark}[2]{\colorbox{#1!47}{$\displaystyle #2$}}
% Commands for Highlighting text -- non tikz method
\renewcommand{\highlight}[2]{\colorbox{#1!17}{#2}}
\renewcommand{\highlightdark}[2]{\colorbox{#1!47}{#2}}
\usepackage{blindtext}
\usepackage{kaobiblio}
\addbibresource{main.bib}
\usepackage[framed=true]{kaotheorems}
\usepackage{kaorefs}

\graphicspath{{examples/documentation/images/}{images/}} % Paths in which to look for images

\makeindex[columns=3, title=按字母排序的索引, intoc] % Create an index

\makeglossaries % Make LaTeX produce the files required to compile the glossary
\input{glossary.tex} % Include the glossary definitions

\makenomenclature % Make LaTeX produce the files required to compile the nomenclature
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%新定义的命令!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\used}{\text{此处使用}}
\newcommand{\blue}{\color{blue}}
\newcommand{\red}{\color{red}}
\newcommand\mb[1]{\mathbf{#1}}
\newcommand\bm[1]{\mathbf{#1}}
\newcommand\mf[1]{\mathfrak{#1}}
\newcommand\bb[1]{\mathbb{#1}}
\newcommand{\tr}{\mathrm{Tr}}
\newcommand{\dt}{\d t}
\newcommand{\dx}{\d x}
\newcommand{\dy}{\d y}
\newcommand{\dz}{\d z}
\newcommand{\dq}{\d q}
\newcommand{\da}{\d a}

\newcommand{\ddx}{\d \mathbf{x}}
\newcommand{\ra}{\rangle}
\newcommand{\la}{\langle}
% 重定义\to
\makeatletter
\def\minusfill{\mathord-\!\!
    \cleaders\hbox{$\!\!\mathord-\!\!$}\hfill
    \!\!\mathord-}
\makeatother
\def\longto{\mathop{\minusfill\!\!\!\rightarrow}\limits}
\def\to{\futurelet\next\toAux}
\def\toAux{\ifx\next^%
    \expandafter\longto%
    \else%
    \ifx\next_%
    \expandafter\longto%
    \else%
    \rightarrow%
    \fi%
    \fi%
}
%%%%定义映射\map{\exp}{\mathbb{R}}{\mathbb{S}^1}{x}{e^{2\pi i x}}
%          \Map{\Delta}{X}{X\times X}{x}{(x,x)} 
\def\map#1#2{\def\mapname{#1}\def\mapdomain{#2}\def\maparrow{\longrightarrow}\futurelet\next\mapAR}
\def\mapAR{\ifx\next[\expandafter\mapar\else\expandafter\mapAux\fi}
\def\mapar[#1]{\def\maparrow{#1}\expandafter\mapAux}
\def\mapAux#1#2{\def\mapcodomain{#1}\def\mapelement{#2}\def\mapmaparrow{\longmapsto}\futurelet\next\mapMAR}
\def\mapMAR{\ifx\next[\expandafter\mapmar\else\expandafter\mapAuxAux\fi}
\def\mapmar[#1]{\def\mapmaparrow{#1}\expandafter\mapAuxAux}
\def\mapAuxAux#1{\def\mapcoelemnt{#1}\futurelet\next\mapAuxAuxAux}
\def\mapAuxAuxAux{\def\nothing{}%
    \ifx\mapname\nothing%
    \mapdomain\maparrow\mapcodomain\qquad\mapelement\mapmaparrow\mapcoelemnt%%
    \else%
    \mapname:\mapdomain\maparrow\mapcodomain\qquad\mapelement\mapmaparrow\mapcoelemnt%
    \fi%
}
\def\Map#1#2{\def\Mapname{#1}\def\Mapdomain{#2}\def\Maparrow{\longrightarrow}\futurelet\next\MapAR}
\def\MapAR{\ifx\next[\expandafter\Mapar\else\expandafter\MapAux\fi}
\def\Mapar[#1]{\def\Maparrow{#1}\expandafter\MapAux}
\def\MapAux#1#2{\def\Mapcodomain{#1}\def\Mapelement{#2}\def\Mapmaparrow{\longmapsto}\futurelet\next\MapMAR}
\def\MapMAR{\ifx\next[\expandafter\Mapmar\else\expandafter\MapAuxAux\fi}
\def\Mapmar[#1]{\def\Mapmaparrow{#1}\expandafter\MapAuxAux}
\def\MapAuxAux#1{\def\Mapcoelemnt{#1}\futurelet\next\MapAuxAuxAux}
\def\MapAuxAuxAux{\def\nothing{}%
    \ifx\Mapname\nothing%
    \begin{array}{rcl}{}
        \Mapdomain&\Maparrow&\Mapcodomain\\{}
        \Mapelement&\Mapmaparrow&\Mapcoelemnt
    \end{array}
    \else%
    \begin{array}{rrcl}{}
        \Mapname:&\Mapdomain&\Maparrow&\Mapcodomain\\{}
        &\Mapelement&\Mapmaparrow&\Mapcoelemnt
    \end{array}
    \fi%
}



%------------方框

\usepackage[most]{tcolorbox}

\newtcolorbox{tbox}[1]{
    colback=ColorBoxBG, colframe=ColorBoxFG, coltext=ColorBoxText,
    sharp corners, enhanced, breakable, parbox=false,
    before skip=1em, after skip=1em,
    title={#1}, fonttitle=\usefont{OT1}{phv}{b}{n}, 
    attach boxed title to top left={yshift=-0.1mm}, boxed title style={sharp corners, colback=ColorBoxFG, left=0.405cm},
    rightrule=-1pt,toprule=-1pt, bottomrule=-1pt
}

\newtcolorbox{ytbox}[1]{
    colback=ColorBoxBG, colframe=color1, coltext=ColorBoxText,
    sharp corners, enhanced, breakable, parbox=false,
    before skip=1em, after skip=1em,
    title={#1}, fonttitle=\usefont{OT1}{phv}{b}{n}, 
    attach boxed title to top left={yshift=-0.1mm}, boxed title style={sharp corners, colback=color1, left=0.405cm},
    rightrule=-1pt,toprule=-1pt, bottomrule=-1pt
}

%%% tikz绘制图标 !!!需要在xcolor后加载
\newcommand*\enumlabel[1]{\tikz[baseline=(char.base)]{
        \node[shape=rectangle,inner sep=2pt,fill=ColorBoxFG] (char) 
        {\fontsize{7}{20}\usefont{OT1}{phv}{b}{n}{\textcolor{ColorBoxBG}{#1}}};}}
%
\newcommand*\yenumlabel[1]{\tikz[baseline=(char.base)]{
        \node[shape=rectangle,inner sep=2pt,fill=color1] (char) 
        {\fontsize{7}{20}\usefont{OT1}{phv}{b}{n}{\textcolor{ColorBoxBG}{#1}}};}}

\newcommand{\textbox}[2]{
    \begin{tbox}{#1}
        #2
    \end{tbox}
}
\newcommand{\ytextbox}[2]{
    \begin{ytbox}{#1}
        #2
    \end{ytbox}
}
\newcommand{\tenum}[1]{
    \begin{enumerate}[label=\protect\enumlabel{\arabic*}, leftmargin=0mm, labelsep=0.265cm, topsep=0.5em
        %, itemsep=1ex
        ]
        #1
    \end{enumerate}
}
\newcommand{\ytenum}[1]{
    \begin{enumerate}[label=\protect\yenumlabel{\arabic*}, leftmargin=0mm, labelsep=0.265cm, topsep=0.5em
        %, itemsep=1ex
        ]
        #1
    \end{enumerate}
}

\tikzset{%
    >=latex, % option for nice arrows
    inner sep=0pt,%
    outer sep=2pt,%
    mark coordinate/.style={inner sep=0pt,outer sep=0pt,minimum size=3pt,
        fill=black,circle}%
}
% 参数1：【可选】变换的名字，默认 `current plane`
% 参数2：极点的倾斜角
% 参数3：经度（东正西负）
\newcommand\LongitudePlane[3][current plane]{
    \tikzset{#1/.estyle={cm={cos(#3),sin(#3)*sin(#2),0,cos(#2),(0,0)}}}
}
\newcommand\DrawLongitude[3][\AngleGamma]{
    \LongitudePlane{#1}{#3}
    \tikzset{current plane/.prefix style={scale=#2}}
    % angle of "visibility"
    \pgfmathsetmacro\angVis{atan(sin(#3)*cos(#1)/sin(#1))} %
    \draw[current plane,thin,black] (\angVis:1) arc (\angVis:\angVis+180:1);
    \draw[current plane,thin,dashed] (\angVis-180:1) arc (\angVis-180:\angVis:1);
}



\setmathfont{Latin Modern Math}





%----------------------------------------------------------------------------------------
\renewcommand\proofname{证明}

%----------------------------------------------------------------------------------------
%自定义的一段无意义文字，用以代替没有中文内容的\blindtext命令。
%简单的直接代替，未来有机会再写成标准的函数命令发布
%----------------------------------------------------------------------------------------
\newcommand{\cblindtext}{你好，这里有一些没有意义的文本。这段文本应该展示在这个地方打印的文本会是什么样子。如果你阅读这段文本，你将不会获得任何信息。真的吗？真的没有信息吗？这段文本和一些无意义的东西，比如 \enquote{Huardest 天不}，有什么区别吗？Kjift - 完全没有！像这样的盲文给你提供了关于所选字体的信息，字母是如何书写的，以及整体外观的印象。这段文本应该包含字母表中的所有字母，并且应该用原始语言书写。内容不需要特别，但单词的长度应该与语言相匹配。}
\usepackage{qftcover}
\coverset
{
    title    = 凝聚态场论:讲义,
    subtitle = Condensed Matter Field Theory : Notes,
    bioinfo  = {Physics:CMFTN},
    color    = DarkGreen,
    head     = background/4,
    logo     = cat/sixpointed stars,
}
\begin{document}
    
    \maketitle
    
    \input{chapters/preface.tex}
    \index{preface}
    
    \begingroup 
    \setlength{\textheight}{230\hscale} 
    \etocclasstocstyle 
    \etocstandardlines 
    \tableofcontents 
    \let\cleardoublepage\bigskip
    \let\clearpage\bigskip
    \endgroup
    
    \mainmatter 
    \setchapterstyle{kao} % Choose the default chapter heading style
    
    \input{chapters/chapter1.tex}
    \input{chapters/chapter2.tex}
    
    \appendix 
    \input{chapters/appendix.tex}
    
    
    \backmatter % Denotes the end of the main document content
    \setchapterstyle{plain} % Output plain chapters from this point onwards
    
    %----------------------------------------------------------------------------------------
    %	BIBLIOGRAPHY
    %----------------------------------------------------------------------------------------
    
    % The bibliography needs to be compiled with biber using your LaTeX editor, or on the command line with 'biber main' from the template directory
    
    \defbibnote{bibnote}{Here are the references in citation order.\par\bigskip} % Prepend this text to the bibliography
    %\printbibliography[heading=bibintoc, title=Bibliography, prenote=bibnote] % Add the bibliography heading to the ToC, set the title of the bibliography and output the bibliography note
    \printbibliography[heading=bibintoc, title=参考文献, prenote=bibnote] % Add the bibliography heading to the ToC and set the title of the bibliography
    
    
    
    %----------------------------------------------------------------------------------------
    %	GLOSSARY
    %----------------------------------------------------------------------------------------
    
    % The glossary needs to be compiled on the command line with 'makeglossaries main' from the template directory
    
    \setglossarystyle{listgroup} % Set the style of the glossary (see https://en.wikibooks.org/wiki/LaTeX/Glossary for a reference)
    \printglossary[title=Special Terms, toctitle=List of Terms] % Output the glossary, 'title' is the chapter heading for the glossary, toctitle is the table of contents heading
    
    %----------------------------------------------------------------------------------------
    %	INDEX
    %----------------------------------------------------------------------------------------
    
    % The index needs to be compiled on the command line with 'makeindex main' from the template directory
    
    \printindex % Output the index
    
    %----------------------------------------------------------------------------------------
    %	BACK COVER
    %----------------------------------------------------------------------------------------
    
    % If you have a PDF/image file that you want to use as a back cover, uncomment the following lines
    
    %\clearpage
    %\thispagestyle{empty}
    %\null%
    %\clearpage
    %\includepdf{cover-back.pdf}
    
    %----------------------------------------------------------------------------------------
    
\end{document}
